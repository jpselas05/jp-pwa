<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vision - Notifica√ß√µes</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="icons/vision_icon.jpg">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            height: 100vh;
            background: radial-gradient(circle at center, #0a0a0a 40%, #000000 100%);
            color: #d4af37;
            /* dourado */
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            text-align: center;
            overflow: hidden;
        }

        h1 {
            font-size: 2.5rem;
            letter-spacing: 1px;
            margin-bottom: 0.5rem;
            text-shadow: 0 0 10px rgba(212, 175, 55, 0.4);
        }

        p {
            color: #b99d34;
            margin-bottom: 2.5rem;
            font-size: 1rem;
            max-width: 320px;
            line-height: 1.6;
        }

        button {
            background: linear-gradient(135deg, #d4af37, #b88a2b);
            color: #000;
            border: none;
            padding: 0.9rem 2.2rem;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(212, 175, 55, 0.3);
            transition: all 0.3s ease;
        }

        button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.6);
        }

        footer {
            position: absolute;
            bottom: 15px;
            font-size: 0.8rem;
            color: #9b8326;
            opacity: 0.8;
        }

        img.logo {
            width: 150px;
            margin-bottom: 1.2rem;
            filter: drop-shadow(0 0 10px rgba(212, 175, 55, 0.4));
            border-radius: 20px;
        }

        @media (max-width: 600px) {
            h1 {
                font-size: 1.8rem;
            }

            img.logo {
                width: 120px;
            }
        }
    </style>
</head>

<body>
    <img src="icons/vision_icon.jpg" alt="Vision Logo" class="logo">
    <h1>Vision</h1>
    <p>Ative as notifica√ß√µes para acompanhar suas movimenta√ß√µes em tempo real.</p>
    <button id="ativar">Ativar Notifica√ß√µes</button>

    <footer>by JP ‚ö° Vision Network</footer>

    <script>
        const SERVER = "https://clavicular-vickey-furtively.ngrok-free.dev";
        const VAPID_PUBLIC = "BPH4cawsNXPd-sm-ycjGiZPAZot7RCuQ2UqpUA7mLtF7NtcS4lJs8lLoAQLZh5ey-xDc6ZcjXHdEXjnWRkhaE50";

        function urlBase64ToUint8Array(base64String) {
            const padding = "=".repeat((4 - base64String.length % 4) % 4);
            const base64 = (base64String + padding).replace(/-/g, "+").replace(/_/g, "/");
            const raw = atob(base64);
            const output = new Uint8Array(raw.length);
            for (let i = 0; i < raw.length; ++i) output[i] = raw.charCodeAt(i);
            return output;
        }

        async function enablePush() {
            const reg = await navigator.serviceWorker.register("sw.js");
            console.log("‚úÖ Service Worker registrado:", reg);

            const perm = await Notification.requestPermission();
            if (perm !== "granted") {
                alert("Permiss√£o negada para notifica√ß√µes!");
                return;
            }

            const sub = await reg.pushManager.subscribe({
                userVisibleOnly: true,
                applicationServerKey: urlBase64ToUint8Array(VAPID_PUBLIC)
            });

            const res = await fetch(`${SERVER}/subscriptions`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(sub)
            });

            if (res.ok) {
                alert("üéâ Inscri√ß√£o feita com sucesso! Voc√™ j√° pode receber notifica√ß√µes.");
            } else {
                alert("‚ùå Erro ao registrar a subscription no servidor.");
            }
        }

        document.getElementById("ativar").addEventListener("click", enablePush);
    </script>
</body>

</html>